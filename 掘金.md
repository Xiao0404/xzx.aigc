
![OIP-C (1).jpg](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/0014410c14bd43338656c13b6b064c1f~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722784197&x-orig-sign=ixpm2CeZZXqJGA6ti4zPW7DkdBY%3D)

# 引言
在上篇文章中[轻松上手 Coze：三步教你快速创建 AI 应用！ - 掘金 (juejin.cn)](https://juejin.cn/post/7370002856038678528)，我们搭建了一个简单的可以为我们收集新闻的 AI Agent (机器人)。在本篇文章中，我们将学一点更加进阶的技能————工作流。当我们为 Agent 设计好了工作流后，Agent便可以高质量的完成复杂的任务。本片文章将以搭建一个帮助用户购车的 Agent 的工作流为例来讲解工作流的使用和搭建。

# 理论

## 什么是工作流
如果我们要去坐火车出现，我们一般要经过以下流程：进火车站 -> 过安检 -> 候车 -> 检票 -> 上车 -> 行驶 -> 到达目的地 -> 出火车站。而这个过程就是我们需求目标的一个工作流，一个工作流包含了多个节点，每个节点都完成一个固定的任务，

工作流就是一组预定义的标准化的步骤，用来完成特定的任务和达到预期的目标。工作流是AI应用的流程定制工具，它可以帮助我们定义应用的运行步骤，从输入到输出。

## 工作流的应用场景
一个 AI Agent 的本质就是，Agent = LLM + 记忆 + 感知 + 规划 + 使用工具 。而 LLM 作为 生成内容的核心，也就是 Agent 的大脑，而 prompt 提示词是作为启发大脑(LLM)生成内容的关键，影响着生成内容的质量。如果我们要解决的问题比较简单，那提示词也会比较少和简单。如果需要解决的问题很多也很复杂，那么就会达到大语言模型的能力边界——上下文限制，从而导致 LLM 输出的质量下降。

要解决这个有两个方式。其一是提升 LLM 的能力，包括 `理解能力` 、 `推理能力` 还有 增加上下文的限制的长度。但是这种方式对个人开发者成本太高了！

于是我们选择第二种方式，类似于算法中的一种 `分治思想` ，分而治之。就是把复杂的问题拆解成多个简单的子问题，把所有的子问题解决了，就可以完成需求。

# 搭建工作流
这里我使用的是国外版的Coze，因为可以免费白嫖GPT4o😎。[Coze](https://www.coze.com/)
我们先分析我们的工作流要达成的是什么需求。我们要创建的是一个给客户推荐适合他们需求的车的 Agent。便需要搜索、分析、总结、生成图片的功能。

每个功能最好用一个单独的工作流，方便后期管理。这里我们以创建一个生成图片的工作流为示例。

首先，我们点击工作流模块的添加按钮。

![屏幕截图 2024-08-03 201122.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/23be42f00a1341c485cd35a8de90680d~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=Uxp14WMWn3UeuzjkQa8fGHS27m8%3D)

如果之前没有发布工作流，则点击创建。

![屏幕截图 2024-08-03 201334.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/e3d3f5d23e3842159b80a4b01490a6d2~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=UzAC4eOvQj%2FVu7B6CNhjlVrYhjc%3D)




![屏幕截图 2024-08-03 201719.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/4b4be5fd80834b68879141107061b1a4~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=IOZaOlYhdznz%2BlRrZLBHqN%2BtOrY%3D)

创建之后，就可以进入工作流编辑区域了，左边是节点选择区域，可以选择添加：插件、LLM、数据库等节点。
右侧是工作流的编辑区域。

一个工作流是由多个节点构成，节点是组成工作流的最基本单位。而每个工作流都会由两个默认的节点。开始节点和结束节点。类似于一个程序的 `input`和 `output` 。开始节点就是用户输入信息的节点，结束节点就给用户输出的节点。

![屏幕截图 2024-08-03 202018.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/55f36b013afa45d7a29d05b6ba0e6aaf~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=qYV5yjPL6Emre7500CaKP7TQBqI%3D)


首先我们对开始节点的参数进行配置

![屏幕截图 2024-08-03 203021.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/3cecda4e4a484ee89cfe7a7f80c965a4~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=B3p%2FjZYzAD%2Fpb6zNsUXfCKoHsIc%3D)

然后再将两个节点相连，相连之后后面的节点就能引用前面的节点上的字段了。

![屏幕截图 2024-08-03 203355.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/3b8087b69d1040f4ac10602cda95fd50~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=%2BF0LMT3WR1Uy2tC8Ztt2Q%2F2iCTI%3D)

然后我们再试运行


![屏幕截图 2024-08-03 203730.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/e4cf2f30588c4e8aac35205170a4dad3~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=KrLsKbVI%2FvMePJtMIz334oo6jCw%3D)



![屏幕截图 2024-08-03 203853.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/ab8b2fdfc2cd4c288d5634a1cce308e7~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=xvcgUydgh4LcsVBwnbM3EoLVdMc%3D)

可以看到我们输入了什么，结束节点就输出了什么，这就是最简单的输入输出工作流，中间没有任何处理环节。



![屏幕截图 2024-08-03 204015.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/cf38d50098bd4a25a38369634546d71a~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=d3a4dBHkbZgIVqx9bp0%2BLgEgHog%3D)

要达成我们生成图片的需求，肯定还需要加入一些条件。我们可以去添加一个可以生成图片的大模型插件。我们点击添加插件，进入插件市场。

![屏幕截图 2024-08-03 205702.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/46606d31b0a444dd9acd37fe080485cf~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=xTypYvOFIbXzaQb2hRx1h0j58CI%3D)

然后我们选择图片专栏，选择 `DALLE3` ,这是一个专门文生图的大模型的插件，十分强悍，可以通过输入 `prompt` 生成图片，我们点击 Add 按钮，就可以在节点编辑区域看到了。


![屏幕截图 2024-08-03 224804.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/68a4ddc7df484b5abb142f4b8cdf672e~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722782971&x-orig-sign=T2Uqs7fR9PHn0%2Ft3kjrbcOm9UOY%3D)

我们把这个插件放在开始和结束节点之间，连起来之后，将 prompt 参数引用开始节点的 input，还有一个 ratio 参数就是生成图片的分辨率，我们不填就是默认的分辨率了。

![屏幕截图 2024-08-03 211614.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/59a36599bfff427c8c364dfb06125776~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=JjWk%2FbxAzTkT6b7EdYfwCuBDJfY%3D)

然后就是结束节点修改一下引用参数

![屏幕截图 2024-08-03 212115.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/fb6d59fa6b624d85bf1ee0d257157cd8~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=yUIqRfURvf2gWZJT%2BmE3mZsWbcI%3D)

修改完成之后，我们便可以试运行了




![屏幕截图 2024-08-03 212301.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/c25441f360534fdc955e7b68456fcad9~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=psmdn5PgWE0wYeyoAPZLbTtELJA%3D)



![image.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/5f3243d02cdb473eb338377883f08151~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722784089&x-orig-sign=J%2FbXSwBhqKjwmw7vydmxY%2FoDqMw%3D)

这生成的 dream car 还是挺帅的，但是质量还是有待提高。用过其他 AI 生图网站(midjourney 、 stable defussion)的小伙伴应该知道，生成的图片质量与给的提示词有关。英文的提示词优于中文提示词；提示词的丰富度能够提升画面细节。

因此我们还需要对输入进插件的提示词优化，我们可以在开始节点和插件之间加一道优化提示词的条件。添加一个 LLM 插件。我们添加一个当前最先进的 GPT4o 模型优化我们的提示词。

![屏幕截图 2024-08-03 213855.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/59bb12df22744f9c8558eb0c5fee5ce0~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=qGdcxxPChcpyI5sxeYMpAIW5QfM%3D)

连接新节点后 LLM 的字段引用开始节点的 input ，这里可以注意到 coze 还可以用 **花括号** 在字符串内容里去引用上面的变量。还有记得修改一下插件的引用，引用的是 LLM 输出的提示词。

了最后要修改的是结束节点，我们这次选中填写回复内容，且开启了流式输出，因为插件生成图片会花很多时间，要先把生成的内容先展示出来会更人性化。值得注意的是 `![](url)` 这里用的是 markdown 的语法。



![屏幕截图 2024-08-03 214021.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/8509d477a0e54f8ab9c81c4dd8ef3de8~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=slNGWxetKHB8XlRGZ138%2BA0oH0s%3D)

修改完成后，我们可以去试运行了。最后我们再发布这个工作流，并添加到我们的 Bot 中。
我们的工作流便完成了！

![屏幕截图 2024-08-03 215006.png](https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/44a97d4cd228450fbfe22d777111fe04~tplv-73owjymdk6-jj-mark:0:0:0:0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMzE2MDQ3MTY2MzU1NzIxMiJ9&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1722780749&x-orig-sign=lhK3G%2FMJ8Orj3wWfC90T9R3QfXI%3D)

# 总结
通过Coze的工作流，我们可以轻松创建一个根据输入内容生成图片的应用。这不仅展示了AIGC的强大功能，也为我们提供了灵活的AI应用开发工具。希望本文能帮助你理解工作流的概念，并在Coze平台上创建自己的AI应用。写文章不易，如果对你有帮助的话可以点个赞哦😊！